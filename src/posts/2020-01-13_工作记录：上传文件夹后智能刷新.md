---
id: 6d14a937-73df-45b6-b1eb-a14c95ab8140
title: 工作记录：上传文件夹后智能刷新
createTime: 2020-01-13
updateTime: 2020-01-13
categories: 工作记录
tags:
description: 2020.01.13 工作记录：上传文件夹时保留文件层级。在上传过程中用户仍可以进行操作，可能进入了其他文件夹。文件上传成功后，需要实现“智能”刷新（用户当前所在文件夹中有新内容，才刷新）
---

2020.01.13

## 1.1 需求：上传文件夹后，智能刷新

### 1.1 上传文件夹，保留层级结构

用户可以把文件夹上传到系统中，上传后会保留文件夹的层级结构。
具体做法是：如果系统中已经有同名文件夹，那么直接放到这个文件夹中。如果没有，则新建一个文件夹。
![在这里插入图片描述](..\post-assets\67b954a5-9adb-422f-9a75-c726933e0508.png)

### 1.2 文件上传成功后，智能刷新

下图中，有蓝色星星标志的是文件，上传成功之后需要自动刷新：
![---](..\post-assets\6993e010-6294-429d-9dc3-ec4951ec03bd.png)
但是！文件在上传时，用户仍可以进行操作，可能进入了其他文件夹。

比如说：【盾之勇者成名录.png】上传成功。此时用户正在【4 月新番】文件夹中，这时候就不需要刷新，如下图：
![在这里插入图片描述](..\post-assets\b1012fbd-6c3f-4adf-b241-b0df54d2b4a5.png)

这种 ==智能== 刷新，怎么实现呢？

---

## 2 分析

### 2.1 简单情况：没有新建文件夹

先看简单的情况：上传文件的过程中，不需要新建文件夹，如下图：
![在这里插入图片描述](..\post-assets\519f632f-491e-4736-a4e0-9661a9855d9a.png)
【辉夜.png】上传成功之后，只有用户在【校园恋爱】文件夹时，才需要刷新。

### 2.2 复杂情况：有新建文件夹

再看复杂的情况：上传文件的过程中，需要新建文件夹，如下图：
![在这里插入图片描述](..\post-assets\7ef0fa65-8458-452c-8ff1-f95ff234f525.png)
【盾之勇者.png】上传过程中，新建了一个文件夹【热血冒险】。
【盾之勇者.png】上传成功后，只有用户在【1 月新番】文件夹时，才需要刷新（这时候刷新出来是文件夹【热血冒险】）。

### 从根源分析：==为什么要刷新？==

因为当前文件夹中出现新的内容了，要刷新后才能看到。

所以，我们需要判断：**某文件上传完成之后，用户所在的当前文件夹中，是否有新的内容。（这个新的内容可能是文件，也可能是自动创建的文件夹）**

那么，哪个文件夹会出现新内容呢？
在上传这个文件的过程中，==新建的内容中，最外层内容，的所在文件夹==，会出现新内容
![在这里插入图片描述](..\post-assets\11dc277a-e715-4b77-8077-c3c6faaf6855.png)
如上图：【盾之勇者.png】上传完成，只有在【1 月新番】中会出现新内容。
所以判断用户当前是不是在【1 月新番】文件夹中。是，就刷新；不是，则不需要刷新。

---

## 3 总结

每个文件上传成功之后，判断：
用户当前所在文件夹，是不是 **新建的内容中，最外层内容的所在文件夹**。
如果是，则刷新；不是，则不需要刷新。
