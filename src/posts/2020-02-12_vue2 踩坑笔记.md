---
id: 95f8551e-aa55-46e0-901b-7348879b594c
title: vue2 踩坑笔记
createTime: 2020-02-12
updateTime: 2020-02-12
categories: vue
tags:
description: 记录学习、使用 vue2 时踩的坑和解决办法
---

## v-if 的"适当"陷阱

如果 `v-if` `v-else` 的两个组件比较像，vue 可能会复用其中的部分内容。不想让他复用就加 key
![在这里插入图片描述](..\post-assets\388976fd-352a-4f27-9af0-b73ef106e725.png)
详细描述看之前的文章：[解决＜ el-select ＞单选、多选切换时出现的 bug](https://blog.csdn.net/tangran0526/article/details/118513920)

## 内部监听生命周期函数

出处：[前端进击者-实战技巧，Vue 原来还可以这样写](https://juejin.im/post/5eef7799f265da02cd3b82fe)

在 Vue 组件中，可以用 `$on` , `$once` 去监听所有的生命周期钩子函数

```js
  mounted() {
  	// 监听和销毁放在一起写，可读性强
    window.addEventListener('resize', this.handleResize)
    this.$once('hook:beforeDestroy', () => {
      window.removeEventListener('resize', this.handleResize)
    })
  },
```

## 自制 v-model

一个组件上的 v-model 默认会利用名为 value 的 prop 和名为 input 的事件。
[官方说明](https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model)

## $nextTick

Vue 在更新 DOM 时是**异步**执行的。

`this.$nextTick()`：等待 DOM 更新完成

```js
// 给 tree 的数据赋值
this.treeData = data;
// 如果有数据，那么选中第一个 tree 节点
if (this.treeData.length > 0) {
  this.$nextTick(() => {
    this.$refs.tree.setCurrentKey(this.treeData[0].id);
  });
}
```

## watch

1.  不要用箭头函数，因为 this 指向会出错

2.  设置 `immediate:true` 的话，回调函数中不能有 DOM 操作。

    ```mermaid
    graph LR
    A[监听开始<br>因为设置了 immediate:true 所以立即触发一次回调]  --> B[ created ];
    B --> D[ mounted ]
    ```

    如上图，第一次触发回调的时候，页面还没有开始渲染，所以不能进行 DOM 操作（ $refs 是取不到的）

## 记得关掉定时器、监听事件

某一个组件中开启了定时器（如系统监控），那么在访问了这个组件后，定时器就开启了。
这时切换到其他的组件，定时器不会自动关闭。

```js
beforeRouteLeave(to, from, next) {
    clearInterval(this.timer);
    next();
},
```

## provide 和 inject 不支持响应式

`provide` 和 `inject` 的写法不支持响应式。

所以，如果值可能变化，就不能这么传递。
